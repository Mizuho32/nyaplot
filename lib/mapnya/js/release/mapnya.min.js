/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

!function(t,e){var n=e();"undefined"!=typeof define&&define.amd&&define(n),t.Mapnya=n}(this,function(){var t,e,n;return function(r){function o(t,e){return v.call(t,e)}function i(t,e){var n,r,o,i,a,l,s,c,f,u,p,d=e&&e.split("/"),h=y.map,m=h&&h["*"]||{};if(t&&"."===t.charAt(0))if(e){for(d=d.slice(0,d.length-1),t=t.split("/"),a=t.length-1,y.nodeIdCompat&&z.test(t[a])&&(t[a]=t[a].replace(z,"")),t=d.concat(t),f=0;f<t.length;f+=1)if(p=t[f],"."===p)t.splice(f,1),f-=1;else if(".."===p){if(1===f&&(".."===t[2]||".."===t[0]))break;f>0&&(t.splice(f-1,2),f-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((d||m)&&h){for(n=t.split("/"),f=n.length;f>0;f-=1){if(r=n.slice(0,f).join("/"),d)for(u=d.length;u>0;u-=1)if(o=h[d.slice(0,u).join("/")],o&&(o=o[r])){i=o,l=f;break}if(i)break;!s&&m&&m[r]&&(s=m[r],c=f)}!i&&s&&(i=s,l=c),i&&(n.splice(0,l,i),t=n.join("/"))}return t}function a(t,e){return function(){return d.apply(r,b.call(arguments,0).concat([t,e]))}}function l(t){return function(e){return i(e,t)}}function s(t){return function(e){g[t]=e}}function c(t){if(o(x,t)){var e=x[t];delete x[t],_[t]=!0,p.apply(r,e)}if(!o(g,t)&&!o(_,t))throw new Error("No "+t);return g[t]}function f(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function u(t){return function(){return y&&y.config&&y.config[t]||{}}}var p,d,h,m,g={},x={},y={},_={},v=Object.prototype.hasOwnProperty,b=[].slice,z=/\.js$/;h=function(t,e){var n,r=f(t),o=r[0];return t=r[1],o&&(o=i(o,e),n=c(o)),o?t=n&&n.normalize?n.normalize(t,l(e)):i(t,e):(t=i(t,e),r=f(t),o=r[0],t=r[1],o&&(n=c(o))),{f:o?o+"!"+t:t,n:t,pr:o,p:n}},m={require:function(t){return a(t)},exports:function(t){var e=g[t];return"undefined"!=typeof e?e:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:u(t)}}},p=function(t,e,n,i){var l,f,u,p,d,y,v=[],b=typeof n;if(i=i||t,"undefined"===b||"function"===b){for(e=!e.length&&n.length?["require","exports","module"]:e,d=0;d<e.length;d+=1)if(p=h(e[d],i),f=p.f,"require"===f)v[d]=m.require(t);else if("exports"===f)v[d]=m.exports(t),y=!0;else if("module"===f)l=v[d]=m.module(t);else if(o(g,f)||o(x,f)||o(_,f))v[d]=c(f);else{if(!p.p)throw new Error(t+" missing "+f);p.p.load(p.n,a(i,!0),s(f),{}),v[d]=g[f]}u=n?n.apply(g[t],v):void 0,t&&(l&&l.exports!==r&&l.exports!==g[t]?g[t]=l.exports:u===r&&y||(g[t]=u))}else t&&(g[t]=n)},t=e=d=function(t,e,n,o,i){if("string"==typeof t)return m[t]?m[t](e):c(h(t,e).f);if(!t.splice){if(y=t,y.deps&&d(y.deps,y.callback),!e)return;e.splice?(t=e,e=n,n=null):t=r}return e=e||function(){},"function"==typeof n&&(n=o,o=i),o?p(r,t,e,n):setTimeout(function(){p(r,t,e,n)},4),d},d.config=function(t){return d(t)},t._defined=g,n=function(t,e,n){e.splice||(n=e,e=[]),o(g,t)||o(x,t)||(x[t]=[t,e,n])},n.amd={jQuery:!0}}(),n("contrib/almond/almond",function(){}),n("tools",[],function(){var t={STL:Nyaplot.STL,_:Nyaplot._,uuid:Nyaplot.uuid,Manager:Nyaplot.Manager};return t}),n("components/scale",["tools"],function(t){function e(t,e){Math.abs(e.x[1]-e.x[0]),Math.abs(e.y[1]-e.y[0]);return this.offset={x:0,y:0},this.scale=1,this}t._;return e.prototype.init=function(t){this.projection=t},e.prototype.get=function(t,e){var n=this.projection([t,e]);return{x:n[0]*this.scale+this.offset.x,y:n[1]*this.scale+this.offset.y}},e.prototype.setTranslate=function(t,e){this.offset.x=t,this.offset.y=e},e.prototype.setScale=function(t){this.scale=t},e}),n("components/axis",["tools"],function(t){function e(e,n,r){var o=t._,i=(t.Manager,{width:0,height:0,margin:{top:0,bottom:0,left:0,right:0},x_label:"X",y_label:"Y",zoom:!0,zoom_range:[0,500],rotate_x_label:0,rotate_y_label:0,pane_uuid:null,z_index:0,extra:{}}),a={map_data:null,color:["none"],text_color:"#fff",text_size:"1em",stroke_color:"#000"};arguments.length>2&&(o.extend(i,r),o.extend(a,r.extra),i.extra=a);var l=d3.scale.ordinal().range(i.extra.color),s=e.append("g"),c="clip"+i.pane_uuid;s.append("clipPath").attr("id",c).append("rect").attr({x:0,y:0,width:i.width,height:i.height}),s.attr("clip-path","url(#"+c+")").append("g").attr("class","map").style("z-index",i.z_index);var f=d3.geo.mercator().center([13,35]).scale(1e3);n.init(f);var u=d3.geo.path().projection(f),p=d3.geo.graticule();s.select(".map").append("path").datum(p).attr({d:u,stroke:"#fff","stroke-width":2});s.select(".map").selectAll("path").data(i.extra.map_data.features).enter().append("path").attr("d",u).attr("stroke",i.extra.stroke_color).attr("fill",function(t){return l(t.id)});i.zoom&&e.call(d3.behavior.zoom().scaleExtent(i.zoom_range).on("zoom",function(){var t=d3.event.translate,r=d3.event.scale;n.setTranslate(t[0],t[1]),n.setScale(r),e.select(".context_child").attr("transform","translate("+t+") scale("+r+")"),s.select(".map").attr("transform","translate("+t+") scale("+r+")")}))}return e}),n("main",["require","exports","module","components/scale","components/axis"],function(t){var e={};return e.Nya={scale:t("components/scale"),axis:t("components/axis")},e}),e("main")});