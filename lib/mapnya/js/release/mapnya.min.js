/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

!function(e,t){var n=t();"undefined"!=typeof define&&define.amd&&define(n),e.Mapnya=n}(this,function(){var e,t,n;return function(r){function o(e,t){return v.call(e,t)}function i(e,t){var n,r,o,i,a,l,c,u,s,f,p,d=t&&t.split("/"),m=y.map,g=m&&m["*"]||{};if(e&&"."===e.charAt(0))if(t){for(d=d.slice(0,d.length-1),e=e.split("/"),a=e.length-1,y.nodeIdCompat&&z.test(e[a])&&(e[a]=e[a].replace(z,"")),e=d.concat(e),s=0;s<e.length;s+=1)if(p=e[s],"."===p)e.splice(s,1),s-=1;else if(".."===p){if(1===s&&(".."===e[2]||".."===e[0]))break;s>0&&(e.splice(s-1,2),s-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((d||g)&&m){for(n=e.split("/"),s=n.length;s>0;s-=1){if(r=n.slice(0,s).join("/"),d)for(f=d.length;f>0;f-=1)if(o=m[d.slice(0,f).join("/")],o&&(o=o[r])){i=o,l=s;break}if(i)break;!c&&g&&g[r]&&(c=g[r],u=s)}!i&&c&&(i=c,l=u),i&&(n.splice(0,l,i),e=n.join("/"))}return e}function a(e,t){return function(){return d.apply(r,b.call(arguments,0).concat([e,t]))}}function l(e){return function(t){return i(t,e)}}function c(e){return function(t){h[e]=t}}function u(e){if(o(x,e)){var t=x[e];delete x[e],_[e]=!0,p.apply(r,t)}if(!o(h,e)&&!o(_,e))throw new Error("No "+e);return h[e]}function s(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function f(e){return function(){return y&&y.config&&y.config[e]||{}}}var p,d,m,g,h={},x={},y={},_={},v=Object.prototype.hasOwnProperty,b=[].slice,z=/\.js$/;m=function(e,t){var n,r=s(e),o=r[0];return e=r[1],o&&(o=i(o,t),n=u(o)),o?e=n&&n.normalize?n.normalize(e,l(t)):i(e,t):(e=i(e,t),r=s(e),o=r[0],e=r[1],o&&(n=u(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},g={require:function(e){return a(e)},exports:function(e){var t=h[e];return"undefined"!=typeof t?t:h[e]={}},module:function(e){return{id:e,uri:"",exports:h[e],config:f(e)}}},p=function(e,t,n,i){var l,s,f,p,d,y,v=[],b=typeof n;if(i=i||e,"undefined"===b||"function"===b){for(t=!t.length&&n.length?["require","exports","module"]:t,d=0;d<t.length;d+=1)if(p=m(t[d],i),s=p.f,"require"===s)v[d]=g.require(e);else if("exports"===s)v[d]=g.exports(e),y=!0;else if("module"===s)l=v[d]=g.module(e);else if(o(h,s)||o(x,s)||o(_,s))v[d]=u(s);else{if(!p.p)throw new Error(e+" missing "+s);p.p.load(p.n,a(i,!0),c(s),{}),v[d]=h[s]}f=n?n.apply(h[e],v):void 0,e&&(l&&l.exports!==r&&l.exports!==h[e]?h[e]=l.exports:f===r&&y||(h[e]=f))}else e&&(h[e]=n)},e=t=d=function(e,t,n,o,i){if("string"==typeof e)return g[e]?g[e](t):u(m(e,t).f);if(!e.splice){if(y=e,y.deps&&d(y.deps,y.callback),!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},"function"==typeof n&&(n=o,o=i),o?p(r,e,t,n):setTimeout(function(){p(r,e,t,n)},4),d},d.config=function(e){return d(e)},e._defined=h,n=function(e,t,n){t.splice||(n=t,t=[]),o(h,e)||o(x,e)||(x[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("contrib/almond/almond",function(){}),n("tools",[],function(){var e={STL:Nyaplot.STL,_:Nyaplot._,uuid:Nyaplot.uuid,Manager:Nyaplot.Manager};return e}),n("components/scale",["tools"],function(e){function t(e,t){Math.abs(t.x[1]-t.x[0]),Math.abs(t.y[1]-t.y[0]);return this}e._;return t.prototype.init=function(e){this.projection=e},t.prototype.get=function(e,t){var n=this.projection.projection(e,t);return{x:n[0],y:n[1]}},t}),n("components/axis",["tools"],function(e){function t(t,n,r){var o=e._,i=(e.Manager,{width:0,height:0,margin:{top:0,bottom:0,left:0,right:0},x_label:"X",y_label:"Y",zoom:!0,zoom_range:[0,500],rotate_x_label:0,rotate_y_label:0,pane_uuid:null,z_index:0,extra:{}}),a={map_data:null,color:["none"],text_color:"#fff",text_size:"1em",stroke_color:"#000"};arguments.length>2&&(o.extend(i,r),o.extend(a,r.extra),i.extra=a);var l=d3.scale.ordinal().range(i.extra.color),c=t.append("g"),u="clip"+i.pane_uuid;c.append("clipPath").attr("id",u).append("rect").attr({x:0,y:0,width:i.width,height:i.height}),c.attr("clip-path","url(#"+u+")").append("g").attr("class","map").style("z-index",i.z_index);var s=d3.geo.mercator().center([13,35]).scale(1e3);n.init(s);var f=d3.geo.path().projection(s),p=d3.geo.graticule();c.select(".map").append("path").datum(p).attr({d:f,stroke:"#fff","stroke-width":2});c.select(".map").selectAll("path").data(i.extra.map_data.features).enter().append("path").attr("d",f).attr("stroke",i.extra.stroke_color).attr("fill",function(e){return l(e.id)});i.zoom&&t.call(d3.behavior.zoom().scaleExtent(i.zoom_range).on("zoom",function(){t.select(".context").attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")"),c.select(".map").attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")}))}return t}),n("main",["require","exports","module","components/scale","components/axis"],function(e){var t={};return t.Nya={scale:e("components/scale"),axis:e("components/axis")},t}),t("main")});